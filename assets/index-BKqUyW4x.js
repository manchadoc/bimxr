import*as f from"https://cdn.skypack.dev/three@0.128.0";import{GLTFLoader as x}from"https://cdn.skypack.dev/three@0.128.0/examples/jsm/loaders/GLTFLoader.js";(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))n(e);new MutationObserver(e=>{for(const t of e)if(t.type==="childList")for(const r of t.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&n(r)}).observe(document,{childList:!0,subtree:!0});function s(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?t.credentials="include":e.crossOrigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function n(e){if(e.ep)return;e.ep=!0;const t=s(e);fetch(e.href,t)}})();async function S(){const l=document.createElement("canvas");document.body.appendChild(l);const o=l.getContext("webgl",{xrCompatible:!0}),s=new f.Scene,n=new f.DirectionalLight(16777215,.3);n.position.set(10,15,10),s.add(n);const e=new f.WebGLRenderer({alpha:!0,preserveDrawingBuffer:!0,canvas:l,context:o});e.autoClear=!1;const t=new f.PerspectiveCamera;t.matrixAutoUpdate=!1;const r=await navigator.xr.requestSession("immersive-ar",{requiredFeatures:["hit-test"]});r.updateRenderState({baseLayer:new XRWebGLLayer(r,o)});const p=await r.requestReferenceSpace("local"),y=await r.requestReferenceSpace("viewer"),L=await r.requestHitTestSource({space:y}),g=new x;let i;g.load("https://immersive-web.github.io/webxr-samples/media/gltf/reticle/reticle.gltf",function(a){i=a.scene,i.visible=!1,s.add(i)});let u;g.load("https://immersive-web.github.io/webxr-samples/media/gltf/sunflower/sunflower.gltf",function(a){u=a.scene}),r.addEventListener("select",a=>{if(u){const c=u.clone();c.position.copy(i.position),s.add(c)}});const w=(a,c)=>{r.requestAnimationFrame(w),o.bindFramebuffer(o.FRAMEBUFFER,r.renderState.baseLayer.framebuffer);const h=c.getViewerPose(p);if(h){const d=h.views[0],b=r.renderState.baseLayer.getViewport(d);e.setSize(b.width,b.height),t.matrix.fromArray(d.transform.matrix),t.projectionMatrix.fromArray(d.projectionMatrix),t.updateMatrixWorld(!0);const v=c.getHitTestResults(L);if(v.length>0&&i){const m=v[0].getPose(p);i.visible=!0,i.position.set(m.transform.position.x,m.transform.position.y,m.transform.position.z),i.updateMatrixWorld(!0)}e.render(s,t)}};r.requestAnimationFrame(w)}document.getElementById("fetchButton").addEventListener("click",()=>{S()});
